<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
      :root {
        --primary-color: #4285f4;
        --primary-dark: #3367d6;
        --success-color: #0f9d58;
        --warning-color: #f4b400;
        --error-color: #db4437;
        --text-dark: #202124;
        --text-light: #5f6368;
        --bg-light: #f8f9fa;
        --border-color: #dadce0;
        --shadow: 0 1px 3px rgba(60,64,67,0.15);
        --shadow-hover: 0 4px 8px rgba(60,64,67,0.2);
        --transition: all 0.2s ease;
      }
      
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: 'Roboto', Arial, sans-serif;
        color: var(--text-dark);
        margin: 0;
        padding: 20px;
        line-height: 1.5;
        font-size: 14px;
      }
      
      .section {
        margin-bottom: 24px;
      }
      
      h3 {
        margin-top: 0;
        color: var(--primary-color);
        font-size: 18px;
        font-weight: 500;
        margin-bottom: 16px;
      }
      
      h4 {
        margin-top: 16px;
        margin-bottom: 8px;
        color: var(--text-dark);
        font-size: 15px;
        font-weight: 500;
      }
      
      p {
        margin: 8px 0;
        color: var(--text-dark);
      }
      
      .version {
        font-size: 12px;
        color: var(--text-light);
        margin-bottom: 8px;
      }
      
      .footer {
        margin-top: 24px;
        border-top: 1px solid var(--border-color);
        padding-top: 12px;
        font-size: 12px;
        color: var(--text-light);
        text-align: center;
      }
      
      ul, ol {
        padding-left: 24px;
        margin: 12px 0;
      }
      
      li {
        margin-bottom: 6px;
      }
      
      .tab-container {
        margin-bottom: 24px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        overflow: hidden;
      }
      
      .tab-buttons {
        display: flex;
        background-color: var(--bg-light);
        border-bottom: 1px solid var(--border-color);
      }
      
      .tab-button {
        padding: 12px 16px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: var(--transition);
        color: var(--text-light);
        position: relative;
        outline: none;
      }
      
      .tab-button:hover {
        background-color: rgba(66,133,244,0.05);
        color: var(--primary-color);
      }
      
      .tab-button.active {
        color: var(--primary-color);
        background-color: #fff;
      }
      
      .tab-button.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: var(--primary-color);
      }
      
      .tab-content {
        display: none;
        padding: 16px;
      }
      
      .tab-content.active {
        display: block;
      }
      
      .version-history {
        max-height: 180px;
        overflow-y: auto;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 12px;
        background: var(--bg-light);
        margin-top: 12px;
      }
      
      .version-item {
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border-color);
      }
      
      .version-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      
      .version-date {
        font-size: 12px;
        color: var(--text-light);
        margin-left: 8px;
      }
      
      a {
        color: var(--primary-color);
        text-decoration: none;
      }
      
      a:hover {
        text-decoration: underline;
      }
      
      .feature-card {
        background-color: white;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: var(--shadow);
        transition: var(--transition);
      }
      
      .feature-card:hover {
        box-shadow: var(--shadow-hover);
      }
      
      .feature-card h4 {
        margin-top: 0;
        color: var(--primary-color);
      }
      
      .feature-card.early-version {
        background-color: #f0f7ff;
        border-color: var(--primary-color);
      }
      
      .support-option {
        position: relative;
        overflow: hidden;
      }
      
      .support-option.loading {
        pointer-events: none;
        opacity: 0.7;
      }
      
      .support-option.loading::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .loading-spinner {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 24px;
        height: 24px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        z-index: 10;
        display: none;
      }
      
      .support-option.loading .loading-spinner {
        display: block;
      }
      
      .loading-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 14px;
        color: var(--primary-color);
        font-weight: 500;
        z-index: 10;
        display: none;
        margin-top: 35px;
      }
      
      .support-option.loading .loading-text {
        display: block;
      }
      
      @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }
      
      .support-option:hover:not(.loading) {
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
      }
    </style>
  </head>
  <body>
    <div class="section">
      <h3>PipedriveSheets</h3>
      <div class="version">Version <?= currentVersion ?></div>
    </div>
    
    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-button active" onclick="openTab(event, 'help')">Help</button>
        <button class="tab-button" onclick="openTab(event, 'support')">Support</button>
        <button class="tab-button" onclick="openTab(event, 'about')">About</button>
        <button class="tab-button" onclick="openTab(event, 'version')">Version History</button>
      </div>
      
      <div id="help" class="tab-content active">
        <div class="feature-card early-version">
          <h4>Heads Up: This Is an Early Version</h4>
          <p>PipedriveSheets is just getting started, and your feedback means a lot!</p>
          <p>If you run into any issues or have ideas for improvement, feel free to email me at <a href="mailto:support@pipedrivesheets.com">support@pipedrivesheets.com</a>. Iâ€™m doing my best to respond quickly and make sure everything runs smoothlyâ€”your input really helps make the add-on better for everyone.</p>
          <p>Thanks for being part of the journey!</p>
        </div>
        
        <div class="section">
          <h4>Getting Started</h4>
          <ol>
            <li>Configure your filter settings in the <b>Pipedrive Settings</b> menu</li>
            <li>Select which columns to display using the <b>Column Selection</b> menu</li>
            <li>Click <b>Sync Data</b> to fetch data from Pipedrive</li>
          </ol>
        </div>
        
        <? if (userPlan === 'team' || userPlan === 'team_inherited') { ?>
        <div class="feature-card">
          <h4>Team Features</h4>
          <p>Use the <b>Team Management</b> option to create or join a team. Team members can share:</p>
          <ul>
            <li>Column preferences</li>
            <li>Filter configurations</li>
            <li>Access to synchronized data</li>
          </ul>
        </div>
        <? } ?>
        
        <? if (userPlan === 'pro_monthly' || userPlan === 'pro_annual' || userPlan === 'team' || userPlan === 'team_inherited') { ?>
        <div class="feature-card">
          <h4>Two-Way Sync</h4>
          <p>Enable <b>Two-Way Sync</b> to push your changes back to Pipedrive:</p>
          <ol>
            <li>Configure two-way sync settings</li>
            <li>Edit data in the sheet</li>
            <li>Click <b>Push Changes to Pipedrive</b> to update your Pipedrive data</li>
          </ol>
        </div>
        <? } ?>
      </div>
      
      <div id="support" class="tab-content">
        <div class="feature-card early-version">
          <h4>ðŸ“ž Get Personal Support</h4>
          <p>Need help? I'm here to support you personally!</p>
          <p>I typically respond to all support requests within 24 hours. Whether you have a bug report, feature request, or just need help getting set up - don't hesitate to reach out.</p>
        </div>
        
        <div class="section">
          <h4>Support Options</h4>
          
          <div id="new-ticket-option" class="feature-card support-option" style="cursor: pointer; margin-bottom: 12px;" onclick="openSupportTicket()">
            <div class="loading-spinner"></div>
            <div class="loading-text">Opening support form...</div>
            <h4 style="color: #4285f4; margin-bottom: 8px;">ðŸŽ« Submit New Support Request</h4>
            <p style="margin: 0;">Create a new support ticket for bugs, feature requests, or general help. I'll respond within 24 hours with personal assistance.</p>
          </div>
          
          <div id="view-tickets-option" class="feature-card support-option" style="cursor: pointer; margin-bottom: 12px;" onclick="viewMyTickets()">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading your tickets...</div>
            <h4 style="color: #4285f4; margin-bottom: 8px;">ðŸ“‹ View My Support Tickets</h4>
            <p style="margin: 0;">Check the status of your existing support requests and continue conversations with our support team.</p>
          </div>
          
          <div id="quick-email-option" class="feature-card support-option" style="cursor: pointer;" onclick="sendQuickEmail()">
            <div class="loading-spinner"></div>
            <div class="loading-text">Opening email...</div>
            <h4 style="color: #4285f4; margin-bottom: 8px;">ðŸ“§ Send Quick Email</h4>
            <p style="margin: 0;">For simple questions, send a quick email directly to <span style="color: #4285f4;">support@pipedrivesheets.com</span></p>
          </div>
        </div>
        
        <div class="section">
          <h4>What to Include in Your Request</h4>
          <ul>
            <li><b>Bug Reports:</b> What you were trying to do, what happened, and any error messages</li>
            <li><b>Feature Requests:</b> Describe what you'd like to see and how it would help your workflow</li>
            <li><b>Integration Issues:</b> Your Pipedrive setup details and which fields you're working with</li>
            <li><b>General Help:</b> What you're trying to accomplish and where you're getting stuck</li>
          </ul>
        </div>
        
        <div class="section">
          <h4>Response Times</h4>
          <ul>
            <li><b>High Priority:</b> Within 12 hours (critical bugs, data issues)</li>
            <li><b>Medium Priority:</b> Within 24 hours (general support, feature requests)</li>
            <li><b>Low Priority:</b> Within 48 hours (documentation questions, enhancement ideas)</li>
          </ul>
        </div>
      </div>
      
      <div id="about" class="tab-content">
        <div class="section">
          <h4>About This Add-on</h4>
          <p>PipedriveSheets seamlessly connects your Google Sheetsâ„¢ with Pipedrive CRM.</p>
          <p>Key features:</p>
          <ul>
            <li>Fetch data from any saved Pipedrive filter</li>
            <li>Customize which fields to display</li>
            <li>Collaborate with team members</li>
            <li>Schedule automatic synchronization</li>
            <li>Push updates back to Pipedrive</li>
          </ul>
        </div>
        
        <div class="section">
          <h4>Support</h4>
          <p>For support or suggestions, please contact:</p>
          <p><a href="mailto:support@pipedrivesheets.com">support@pipedrivesheets.com</a></p>
        </div>
      </div>
      
      <div id="version" class="tab-content">
        <div class="section">
          <h4>Version History</h4>
          <div class="version-history">
            <? if (versionHistory && versionHistory.length > 0) { ?>
              <? versionHistory.forEach(function(version) { ?>
                <div class="version-item">
                  <div><b><?= version.version ?></b> <span class="version-date"><?= version.date ?></span></div>
                  <ul>
                    <? version.changes.forEach(function(change) { ?>
                      <li><?= change ?></li>
                    <? }); ?>
                  </ul>
                </div>
              <? }); ?>
            <? } else { ?>
              <div class="version-item">
                <div><b>1.0.0</b> <span class="version-date">Initial Release</span></div>
                <ul>
                  <li>First public release</li>
                </ul>
              </div>
            <? } ?>
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      &copy; <?= new Date().getFullYear() ?> PipedriveSheets. All rights reserved.
    </div>
    
    <script>
      function openTab(evt, tabName) {
        // Hide all tab content
        var tabContents = document.getElementsByClassName('tab-content');
        for (var i = 0; i < tabContents.length; i++) {
          tabContents[i].classList.remove('active');
        }
        
        // Remove active class from all tab buttons
        var tabButtons = document.getElementsByClassName('tab-button');
        for (var i = 0; i < tabButtons.length; i++) {
          tabButtons[i].classList.remove('active');
        }
        
        // Show the specific tab content
        document.getElementById(tabName).classList.add('active');
        
        // Add active class to the button that opened the tab
        evt.currentTarget.classList.add('active');
      }
      
      function showLoadingState(elementId) {
        const element = document.getElementById(elementId);
        if (element) {
          element.classList.add('loading');
        }
      }
      
      function hideLoadingState(elementId) {
        const element = document.getElementById(elementId);
        if (element) {
          element.classList.remove('loading');
        }
      }
      
      function openSupportTicket() {
        showLoadingState('new-ticket-option');
        
        google.script.run
          .withSuccessHandler(function() {
            // Close help dialog when support ticket opens
            google.script.host.close();
          })
          .withFailureHandler(function(error) {
            hideLoadingState('new-ticket-option');
            alert('Error opening support ticket: ' + error.message);
          })
          .showSupportTicket();
      }
      
      function viewMyTickets() {
        showLoadingState('view-tickets-option');
        
        google.script.run
          .withSuccessHandler(function() {
            // Close help dialog when ticket list opens
            google.script.host.close();
          })
          .withFailureHandler(function(error) {
            hideLoadingState('view-tickets-option');
            alert('Error opening support tickets: ' + error.message);
          })
          .showMyTickets();
      }
      
      function sendQuickEmail() {
        showLoadingState('quick-email-option');
        
        // Show loading for a brief moment then open email
        setTimeout(function() {
          const subject = encodeURIComponent('PipedriveSheets Support Request');
          const body = encodeURIComponent('Hi there,\n\nI need help with PipedriveSheets.\n\n[Please describe your question or issue here]\n\nThanks!');
          const mailtoLink = `mailto:support@pipedrivesheets.com?subject=${subject}&body=${body}`;
          
          // For Google Apps Script, we need to use window.open
          window.open(mailtoLink, '_blank');
          
          // Hide loading state after a short delay
          setTimeout(function() {
            hideLoadingState('quick-email-option');
          }, 500);
        }, 300);
      }
    </script>
  </body>
</html> 