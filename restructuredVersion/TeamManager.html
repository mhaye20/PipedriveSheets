<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <?!= HtmlService.createHtmlOutput('<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">').getContent(); ?>
    <?!= include('TeamManagerUI'); ?>
  </head>
  <body>
    <div id="main-container">
      <h3><?= hasTeam ? 'Team Management' : 'Team Access' ?></h3>
      
      <div class="user-info">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
        <div>Current user: <strong><?= userEmail ?></strong></div>
      </div>
      
      <div id="status-container"></div>
      
      <!-- Tab Navigation -->
      <div class="tab-container">
        <div class="tabs">
          <? if (!hasTeam) { ?>
          <div class="tab <?= initialTab === 'join' ? 'active' : '' ?>" data-tab="join">Join Team</div>
          <div class="tab <?= initialTab === 'create' ? 'active' : '' ?>" data-tab="create">Create Team</div>
          <? } else { ?>
          <div class="tab active" data-tab="manage">Manage Team</div>
          <? } ?>
        </div>
        
        <? if (!hasTeam) { ?>
        <!-- Join Team Tab -->
        <div id="join-tab" class="tab-content <?= initialTab === 'join' ? 'active' : '' ?>">
          <div class="section">
            <div class="section-title">Join an Existing Team</div>
            <p>Enter the team ID provided by your team administrator:</p>
            <div class="form-group">
              <input type="text" id="team-id-input" placeholder="Team ID">
            </div>
            <div class="button-container">
              <button id="join-team-button" class="button-primary">
                <span class="button-text">Join Team</span>
              </button>
            </div>
          </div>
        </div>
        
        <!-- Create Team Tab -->
        <div id="create-tab" class="tab-content <?= initialTab === 'create' ? 'active' : '' ?>">
          <div class="section">
            <div class="section-title">Create a New Team</div>
            <p>Create a new team to share Pipedrive configuration with your colleagues:</p>
            <div class="form-group">
              <input type="text" id="team-name-input" placeholder="Team Name">
            </div>
            <div class="button-container">
              <button id="create-team-button" class="button-primary">
                <span class="button-text">Create Team</span>
              </button>
            </div>
          </div>
        </div>
        <? } else { ?>
        
        <!-- Manage Team Tab -->
        <div id="manage-tab" class="tab-content active">
          <div class="section">
            <div class="section-title">Your Team</div>
            
            <div class="team-card">
              <div class="team-header">
                <div class="team-name"><?= teamName ?></div>
                <div class="badge <?= userRole === 'Admin' ? 'admin' : '' ?>"><?= userRole ?></div>
              </div>
              
              <div>
                <strong>Team ID:</strong> 
                <span id="team-id-display"><?= teamId ?></span>
                <button id="copy-team-id" class="button-secondary member-action">
                  Copy ID
                </button>
                <div class="tooltip">Share this ID with team members you want to invite</div>
              </div>
              
              <!-- Team Members Section -->
              <div class="section-title" style="margin-top: 20px;">Team Members</div>
              <div class="team-members">
                <? for (var i = 0; i < teamMembers.length; i++) { ?>
                <? var member = teamMembers[i]; ?>
                <div class="team-member">
                  <div class="member-info">
                    <div class="member-email"><?= member.email ?></div>
                    <div class="badge <?= member.role === 'Admin' ? 'admin' : '' ?>"><?= member.role ?></div>
                  </div>
                  <? if (userRole === 'Admin' && member.email !== userEmail) { ?>
                  <div class="member-actions">
                    <? if (member.role !== 'Admin') { ?>
                    <button class="member-action promote-member" data-email="<?= member.email ?>">
                      Make Admin
                    </button>
                    <? } else { ?>
                    <button class="member-action demote-member" data-email="<?= member.email ?>">
                      Remove Admin
                    </button>
                    <? } ?>
                    <button class="member-action remove-member" data-email="<?= member.email ?>">
                      Remove
                    </button>
                  </div>
                  <? } ?>
                </div>
                <? } ?>
              </div>
              
              <? if (userRole === 'Admin') { ?>
              <!-- Add Member Form -->
              <div class="section-title" style="margin-top: 20px;">Add Team Member</div>
              <div class="add-member-form">
                <input type="email" id="new-member-email" class="add-member-input" placeholder="Email Address">
                <button id="add-member-button" class="button-primary">
                  <span class="button-text">Add Member</span>
                </button>
              </div>
              <? } ?>
              
              <!-- Team Actions -->
              <div class="button-container" style="margin-top: 24px; border-top: 1px solid var(--border-color); padding-top: 16px;">
                <button id="leave-team-button" class="button-danger">
                  <span class="button-text">Leave Team</span>
                </button>
                <? if (userRole === 'Admin') { ?>
                <button id="delete-team-button" class="button-danger" style="margin-left: 12px;">
                  <span class="button-text">Delete Team</span>
                </button>
                <? } ?>
              </div>
            </div>
          </div>
        </div>
        <? } ?>
      </div>
      
      <div class="button-container">
        <button id="close-button" class="button-secondary">Close</button>
      </div>
    </div>
    
    <div id="loading-container" class="loading hidden">
      <div class="spinner"></div>
    </div>
    
    <?!= include('TeamManagerUI'); ?>
  </body>
</html> 