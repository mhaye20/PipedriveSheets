<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <?!= include('TriggerManagerUI') ?>
  </head>
  <body onload="onLoad()">
    <div class="container">
      <h3>Schedule Automatic Sync</h3>
      
      <div id="statusIndicator" class="indicator"></div>
      
      <div class="sheet-info">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
          <path d="M7 7h10v2H7zm0 4h10v2H7zm0 4h7v2H7z"/>
        </svg>
        <div>Scheduling automatic sync for <strong id="sheetNameDisplay"></strong></div>
      </div>
      
      <div id="twoWaySyncNotice" class="two-way-sync-notice" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </svg>
        <div>
          <strong>Two-way sync is enabled</strong>
          <p>Changes in this sheet will be pushed to Pipedrive before pulling new data during scheduled syncs.</p>
        </div>
      </div>
      
      <div id="existingTriggers"></div>
      
      <h4>Create New Schedule</h4>
      
      <form id="triggerForm">
        <div class="form-group">
          <label for="frequency">Sync Frequency</label>
          <select id="frequency" required>
            <option value="hourly">Hourly</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>
        
        <div id="hourlyIntervalInput" class="form-group">
          <label for="hourlyInterval">Sync Every</label>
          <select id="hourlyInterval">
            <option value="1">1 hour</option>
            <option value="2">2 hours</option>
            <option value="3">3 hours</option>
            <option value="4">4 hours</option>
            <option value="6">6 hours</option>
            <option value="8">8 hours</option>
            <option value="12">12 hours</option>
          </select>
        </div>
        
        <div id="timeInputs" class="form-group time-inputs" style="display: none;">
          <div>
            <label for="hour">Hour</label>
            <select id="hour">
              <? for (let i = 0; i < 24; i++) { ?>
                <? const hour12 = i % 12 === 0 ? 12 : i % 12; ?>
                <? const ampm = i < 12 ? 'AM' : 'PM'; ?>
                <option value="<?= i ?>"><?= hour12 ?>:00 <?= ampm ?></option>
              <? } ?>
            </select>
          </div>
          <div>
            <label for="minute">Minute</label>
            <select id="minute">
              <? for (let i = 0; i < 60; i++) { ?>
                <option value="<?= i ?>"><?= i.toString().padStart(2, '0') ?></option>
              <? } ?>
            </select>
          </div>
        </div>
        
        <div id="daySelection" class="form-group" style="display: none;">
          <label>Days of the Week</label>
          <div class="day-selection">
            <button type="button" class="day-button" data-day="2">Monday</button>
            <button type="button" class="day-button" data-day="3">Tuesday</button>
            <button type="button" class="day-button" data-day="4">Wednesday</button>
            <button type="button" class="day-button" data-day="5">Thursday</button>
            <button type="button" class="day-button" data-day="6">Friday</button>
            <button type="button" class="day-button" data-day="7">Saturday</button>
            <button type="button" class="day-button" data-day="1">Sunday</button>
          </div>
          <p class="help-text">Select one or more days</p>
        </div>
        
        <div id="monthDayInput" class="form-group" style="display: none;">
          <label for="monthDay">Day of Month</label>
          <select id="monthDay">
            <? for (let i = 1; i <= 31; i++) { ?>
              <? const suffix = ['st', 'nd', 'rd'][i - 1] || 'th'; ?>
              <option value="<?= i ?>"><?= i ?><?= suffix ?></option>
            <? } ?>
          </select>
        </div>
        
        <input type="hidden" id="sheetName" value="<?= sheetName ?>">
        <input type="hidden" id="twoWaySyncEnabled" value="<?= twoWaySyncEnabled ?>">
        <input type="hidden" id="currentTriggers" value="<?= JSON.stringify(currentTriggers) ?>">
        
        <div class="button-container">
          <button type="button" class="secondary-btn" onclick="google.script.host.close()">Cancel</button>
          <button type="button" class="primary-btn" id="createButton" onclick="createSchedule()">
            <span class="loading" id="buttonLoading">
              <span class="loader"></span>
            </span>
            Create Schedule
          </button>
        </div>
      </form>
    </div>
    
    <div id="indicator" class="indicator" style="display: none;"></div>
  </body>
</html> 